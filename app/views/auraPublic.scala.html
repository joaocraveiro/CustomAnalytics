@(aura: Aura, profileId: String)

@import play.api.libs.json.Json

@main("Aurasma Custom Analytics", false) {   
	
	<h3>@aura.name</h3>
	
	@for(display <- aura.displays){	
	<br>
		@display.name (@display.metric.name)<br>		
		@if(display.metric.metricEntries.isEmpty){
            <h4>No data available yet!</h4>
    	} else {
    		<div id="@display.name"></div>    					
		}
	}

	<script>		
		@for(display <- aura.displays){
			var data = JSON.parse("@display.userGrouped()".replace(/&quot;/g, '\"').replace(/=/g, ':'));			
			@if(display.plot.equals("text")){
				@if(display.groupUser && display.groupCategory){
					@if(profileId == null){ var data = JSON.parse("@display.userCategoryGrouped(null)".replace(/&quot;/g, '\"').replace(/=/g, ':')); 
					}else{ var data = JSON.parse("@display.userCategoryGrouped(profileId)".replace(/&quot;/g, '\"').replace(/=/g, ':')); }
					for(key in data) document.getElementById("@display.name").innerHTML += key +": " + data[key]+"<br>";
				}
				@if(display.groupUser && !display.groupCategory){					
					var data = JSON.parse("@display.userGrouped()".replace(/&quot;/g, '\"').replace(/=/g, ':'));					
					for(key in data) document.getElementById("@display.name").innerHTML += key +": " + data[key]+"<br>";
				}
			}
			@if(display.plot.equals("donut")){					
				var plotdata = [];
				for(key in data) plotdata.push({label:key,value:data[key]});				
				Morris.Donut({element:"@display.name",data:plotdata})
			}
		}
	</script>

}
